<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[코루틴 코루틴] ch04. 코루틴의 실제 구현 | 2taezeat, blog</title>
<meta name=keywords content="Kotlin,Coroutine"><meta name=description content="ch04. 코루틴의 실제 구현"><meta name=author content="2taezeat"><link rel=canonical href=https://2taezeat.github.io/posts/%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%BD%94%EB%A3%A8%ED%8B%B4/%EC%BD%94%ED%8B%80%EB%A6%B0-%EC%BD%94%EB%A3%A8%ED%8B%B4-ch04.-%EC%BD%94%EB%A3%A8%ED%8B%B4%EC%9D%98-%EC%8B%A4%EC%A0%9C-%EA%B5%AC%ED%98%84/><meta name=google-site-verification content="YaEERzgrvu-ZwPg7gswZdTzRMufkHw3uIH7i8hVal1c"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.cc8105bf49785484525cafc7883272c26982bf06e1663dcfa3b55c3bb3f773b6.css integrity="sha256-zIEFv0l4VIRSXK/HiDJywmmCvwbhZj3Po7VcO7P3c7Y=" rel="preload stylesheet" as=style><link rel=icon href=https://2taezeat.github.io/icon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://2taezeat.github.io/icon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://2taezeat.github.io/icon/favicon-32x32.png><link rel=apple-touch-icon href=https://2taezeat.github.io/icon/apple-touch-icon.png><link rel=mask-icon href=https://2taezeat.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://2taezeat.github.io/posts/%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%BD%94%EB%A3%A8%ED%8B%B4/%EC%BD%94%ED%8B%80%EB%A6%B0-%EC%BD%94%EB%A3%A8%ED%8B%B4-ch04.-%EC%BD%94%EB%A3%A8%ED%8B%B4%EC%9D%98-%EC%8B%A4%EC%A0%9C-%EA%B5%AC%ED%98%84/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="[코루틴 코루틴] ch04. 코루틴의 실제 구현"><meta property="og:description" content="ch04. 코루틴의 실제 구현"><meta property="og:type" content="article"><meta property="og:url" content="https://2taezeat.github.io/posts/%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%BD%94%EB%A3%A8%ED%8B%B4/%EC%BD%94%ED%8B%80%EB%A6%B0-%EC%BD%94%EB%A3%A8%ED%8B%B4-ch04.-%EC%BD%94%EB%A3%A8%ED%8B%B4%EC%9D%98-%EC%8B%A4%EC%A0%9C-%EA%B5%AC%ED%98%84/"><meta property="og:image" content="https://2taezeat.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-04T11:30:03+00:00"><meta property="article:modified_time" content="2024-02-04T11:30:03+00:00"><meta property="og:site_name" content="2taezeat, blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://2taezeat.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="[코루틴 코루틴] ch04. 코루틴의 실제 구현"><meta name=twitter:description content="ch04. 코루틴의 실제 구현"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://2taezeat.github.io/posts/"},{"@type":"ListItem","position":2,"name":"[코루틴 코루틴] ch04. 코루틴의 실제 구현","item":"https://2taezeat.github.io/posts/%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%BD%94%EB%A3%A8%ED%8B%B4/%EC%BD%94%ED%8B%80%EB%A6%B0-%EC%BD%94%EB%A3%A8%ED%8B%B4-ch04.-%EC%BD%94%EB%A3%A8%ED%8B%B4%EC%9D%98-%EC%8B%A4%EC%A0%9C-%EA%B5%AC%ED%98%84/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[코루틴 코루틴] ch04. 코루틴의 실제 구현","name":"[코루틴 코루틴] ch04. 코루틴의 실제 구현","description":"ch04. 코루틴의 실제 구현","keywords":["Kotlin","Coroutine"],"articleBody":"4. 코루틴의 실제 구현 코틀린 중단 함수는 continuation-passing style(CPS) 로 구현되어 있다.\n여러 중단 함수 구현 방식 중 CPS를 선택하였다. Continuation 객체는 상태를 나타내는 숫자와 로컬 데이터를 가지고 있다.\nContinuation 은 함수 인자로 전달된다.\n중단 함수는 상태(state) 를 가지는 state machine 으로 볼 수 있다.\n중단 함수의 Continuation 객체가 이 함수를 부르는 다른 함수의 Continuation 객체를 decorate(장식) 한다.\n모든 Continuation 객체는 resume 하거나 함수가 완료 될때 사용되는 콜 스택으로 사용된다.\n1 2 3 4 5 6 7 8 suspend fun getUser(): User? suspend fun setUser(user: User) suspend fun checkAvailability(flight: Flight): Boolean // 내부 fun getUser(continuation: Continuation\u003c*\u003e): Any? fun setUser(user: User, continuation: Continuation\u003c*\u003e): Any fun checkAvailability(flight: Flight, continuation: Continuation\u003c*\u003e): Any 아주 간단한 중단 함수 알아보기 함수가 시작되는 지점은 함수의 시작점과 중단 이후 재개 시점(컨티뉴에이션이 resume을 호출할 때) 두 곳이다. 현재 상태를 저장에는 label 이라는 field 를 사용한다. (처음에는 0으로 설정) 이후에는 중단되기 전에 다음 상태로 설정되어 재개 될 시점을 알 수 있게 해준다. delay에 의해 중단된 경우 COROUTINE_SUSPENDED 를 반환 myFunction 을 호출한 함수부터 시작해 콜 스택에 있는 모든 함수도 똑 같다. 따라서, 중단이 일어나면 콜 스택에 있는 모든 함수가 종료된다 중단된 코루틴을 실행하던 스레드를 (다른 종류의 코루틴을 포함해) 실행 가능한 코드가 사용할 수 있게 된다. 1 2 3 4 5 6 7 8 suspend fun myFunction() { println(\"Before\") var counter = 0 delay(1000) // suspending counter++ println(\"Counter: $counter\") println(\"After\") } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 // 중단 함수를의 바이트 코드를 자바로 디컴파일한 코드를 코틀린으로 표현한 코드 fun myFunction(continuation: Continuation\u003cUnit\u003e): Any { val continuation = continuation as? MyFunctionContinuation ?: MyFunctionContinuation(continuation) var counter = continuation.counter if (continuation.label == 0) { println(\"Before\") counter = 0 continuation.counter = counter continuation.label = 1 if (delay(1000, continuation) == COROUTINE_SUSPENDED) { return COROUTINE_SUSPENDED } } if (continuation.label == 1) { counter = (counter as Int) + 1 println(\"Counter: $counter\") println(\"After\") return Unit } error(\"Impossible\") } class MyFunctionContinuation( // 컨트뉴에이션 객체 val completion: Continuation\u003cUnit\u003e ) : Continuation\u003cUnit\u003e { override val context: CoroutineContext get() = completion.context var result: Result\u003cUnit\u003e? = null var label = 0 var counter = 0 override fun resumeWith(result: Result\u003cUnit\u003e) { this.result = result val res = try { val r = myFunction(this) if (r == COROUTINE_SUSPENDED) return Result.success(r as Unit) } catch (e: Throwable) { Result.failure(e) } completion.resumeWith(res) } } 상태를 가진 함수 함수가 중단된 후에 다시 사용할 지역 변수나 파라미터와 같은 상태를 가지고 있다면, 함수의 컨티뉴에이션 객체에 상태를 저장해야 한다. 함수 내에서 사용되던 값들은 중단되기 직전에 저장되고, 이후 함수가 재개될 때 복구된다. 값을 받아 재개되는 함수 중단 함수로 부터 값을 받아야 하는 경우 좀 더 복잡해짐 token은 상태 0과 1에서 사용 userId는 상태 1과 2에서 사욛 Result 타입인 result는 함수가 어떻게 재개되었는지 나타냄 함수가 값으로 재개 되면 결과는 Result.Success(result) 함수가 예외로 재개 되면 결과는 Result.Failure(exception) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 suspend fun printUser(token: String) { println(\"Before\") val userId = getUserId(token) // 중단 함수 println(\"Got userId: $userId\") val userName = getUserName(userId, token) // 중단 함수 println(User(userId, userName)) println(\"After\") } fun printUser( token: String, continuation: Continuation\u003c*\u003e ): Any { val continuation = continuation as? PrintUserContinuation ?: PrintUserContinuation( continuation as Continuation\u003cUnit\u003e, token ) var result: Result\u003cAny\u003e? = continuation.result var userId: String? = continuation.userId val userName: String if (continuation.label == 0) { println(\"Before\") continuation.label = 1 val res = getUserId(token, continuation) if (res == COROUTINE_SUSPENDED) { return COROUTINE_SUSPENDED } result = Result.success(res) } if (continuation.label == 1) { userId = result!!.getOrThrow() as String println(\"Got userId: $userId\") continuation.label = 2\t// 다음 label을 설정 continuation.userId = userId\t// 컨티뉴에이션 객체에 상태를 저장 val res = getUserName(userId, continuation) // 중단 함수를 호출 if (res == COROUTINE_SUSPENDED) {\t// 중단 상태일 때 return COROUTINE_SUSPENDED } result = Result.success(res)\t// 중단되지 않았으면 결괏값을 설정 } if (continuation.label == 2) {\tresult!!.throwOnFailure()\t// 실패할 경우 에외를 던짐 userName = result.getOrNull as String\t// 결괏값을 읽음 println(User(userId as String, userName)) println(\"After\") return Unit } error(\"Impossible\") } class PrintUserContinuation( val completion: Continuation\u003cUnit\u003e, val token: String ) : Continuation\u003cString\u003e { override val context: CoroutineContext get() = completion.context var label = 0 var result: Result\u003cAny\u003e? = null var userId: String? = null override fun resumeWith(result: Result\u003cString\u003e) { this.result = result val res = try { val r = printUser(token, this) if (r == COROUTINE_SUSPENDED) return Result.success(r as Unit) } catch (e: Throwable) { Result.failure(e) } completion.resumeWith(res) } } 콜 스택 함수 a가 함수 b를 호출하면 가상 머신은 a의 상태와 b가 끝나면 실행이 될 지점을 콜 스택(call stack)이라는 자료 구조 에 저장한다.\n코루틴을 중단하면 스레드를 반환해 콜 스택에 있는 정보가 사라질 것이다.\n따라서 코루틴을 재개 할 때, 콜 스택을 사용할 수 없다. 대신 Continuation 객체가 콜 스택의 역할을 대신한다. Continuation 객체는 중단 되었을때 상태(label)와 함수의 지역 변수와 파라미터(필드), 중단 함수를 호출한 함수가 재개될 위치 정보를 가지고 있다.\n하나의 Continuation 객체는 다른 하나를 참조하는 식으로 동작한다. Continuation 객체가 재개 될 때, 각 Continuation 객체는 자신이 담당하는 함수를 호출하고, 그 함수의 실행이 끝나면, 자신을 호출한 함수의 Continuation 객체을 재개 합니다. complete.resumeWith(res) 이 과정은 스택의 끝에 다다를 때까지 반복된다. 중단된 함수가 재개했을 때 Continuation 객체로 부터 상태를 복원하고, 얻은 결과를 사용하거나 예외를 던진다.\n컨티뉴에이션 객체에 상태가 저장된며, 중단을 처리하기 위한 과정이 있어야 한다.\n중단된 함수가 재개했을 때 컨티뉴에이션 객체로부터 상태를 복원하고, 얻은 결과를 사용하거나 예외를 던져야 한다.\n예외를 던질 때도 비슷하다, 처리되지 못한 예외가 resumeWith 에서 잡히면 Result.failure(e)로 래핑되며, 예외를 던진 함수를 호출한 함수는 포장된 결과를 받는다.\n함수 c에서 중단된 상황을 예로 들면\n실행이 재개되면 c의 컨티뉴에이션 객체는 c 함수를 먼저 재개\n함수가 완료되면 c 컨티뉴에이션 객체는 b 함수를 호출하는 b 컨티뉴에이션 객체를 재개\nb 함수가 완료되면 b 컨티뉴에이션은 a 컨티뉴에이션을 재개하고 a 함수가 호출된다.\n중단 함수의 성능 함수를 상태로 나누는 것은 숫자를 비교하는 것만큼 쉬운 일이며 실행점이 변하는 비용 또한 거의 들지 않음 컨티뉴에이션 객체에 상태를 저장하는 것 또한 간단하다 지역 변수를 복사하지 않고 새로운 변수가 메모리 내 특정 값을 가리키게 한다. Reference https://kotlinlang.org/docs/coroutines-guide.html 코틀린 코루틴 Kotlin Coroutines: Deep Dive (Marcin Moskała, 인사이트) ","wordCount":"1051","inLanguage":"en","image":"https://2taezeat.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-02-04T11:30:03Z","dateModified":"2024-02-04T11:30:03Z","author":{"@type":"Person","name":"2taezeat"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://2taezeat.github.io/posts/%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%BD%94%EB%A3%A8%ED%8B%B4/%EC%BD%94%ED%8B%80%EB%A6%B0-%EC%BD%94%EB%A3%A8%ED%8B%B4-ch04.-%EC%BD%94%EB%A3%A8%ED%8B%B4%EC%9D%98-%EC%8B%A4%EC%A0%9C-%EA%B5%AC%ED%98%84/"},"publisher":{"@type":"Organization","name":"2taezeat, blog","logo":{"@type":"ImageObject","url":"https://2taezeat.github.io/icon/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://2taezeat.github.io/ accesskey=h title="2taezeat blog (Alt + H)"><img src=https://2taezeat.github.io/icon/apple-touch-icon.png alt aria-label=logo height=30>2taezeat blog</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://2taezeat.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://2taezeat.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://2taezeat.github.io/searchs/ title=Search><span>Search</span></a></li><li><a href=https://github.com/2taezeat title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://2taezeat.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://2taezeat.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">[코루틴 코루틴] ch04. 코루틴의 실제 구현</h1><div class=post-description>ch04. 코루틴의 실제 구현</div><div class=post-meta><span title='2024-02-04 11:30:03 +0000 +0000'>2024-02-04</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;1051 words&nbsp;·&nbsp;2taezeat</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#4-코루틴의-실제-구현>4. 코루틴의 실제 구현</a><ul><li><a href=#아주-간단한-중단-함수-알아보기>아주 간단한 중단 함수 알아보기</a></li><li><a href=#상태를-가진-함수>상태를 가진 함수</a></li><li><a href=#값을-받아-재개되는-함수>값을 받아 재개되는 함수</a></li><li><a href=#콜-스택>콜 스택</a></li><li><a href=#중단-함수의-성능>중단 함수의 성능</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></div></details></div><div class=post-content><h1 id=4-코루틴의-실제-구현>4. 코루틴의 실제 구현<a hidden class=anchor aria-hidden=true href=#4-코루틴의-실제-구현>#</a></h1><ul><li><p>코틀린 중단 함수는 <code>continuation-passing style(CPS)</code> 로 구현되어 있다.</p><ul><li>여러 중단 함수 구현 방식 중 CPS를 선택하였다.</li></ul></li><li><p><code>Continuation</code> 객체는 상태를 나타내는 <strong>숫자와 로컬 데이터</strong>를 가지고 있다.</p></li><li><p><code>Continuation</code> 은 함수 인자로 전달된다.</p></li><li><p>중단 함수는 상태(state) 를 가지는 state machine 으로 볼 수 있다.</p></li><li><p>중단 함수의 <code>Continuation</code> 객체가 이 함수를 부르는 다른 함수의 <code>Continuation</code> 객체를 decorate(장식) 한다.</p></li><li><p>모든 <code>Continuation</code> 객체는 resume 하거나 함수가 완료 될때 사용되는 콜 스택으로 사용된다.</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>suspend</span> <span class=k>fun</span> <span class=nf>getUser</span><span class=p>():</span> <span class=n>User</span><span class=p>?</span>
</span></span><span class=line><span class=cl><span class=k>suspend</span> <span class=k>fun</span> <span class=nf>setUser</span><span class=p>(</span><span class=n>user</span><span class=p>:</span> <span class=n>User</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>suspend</span> <span class=k>fun</span> <span class=nf>checkAvailability</span><span class=p>(</span><span class=n>flight</span><span class=p>:</span> <span class=n>Flight</span><span class=p>):</span> <span class=n>Boolean</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 내부
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fun</span> <span class=nf>getUser</span><span class=p>(</span><span class=n>continuation</span><span class=p>:</span> <span class=n>Continuation</span><span class=p>&lt;*&gt;):</span> <span class=n>Any</span><span class=p>?</span>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>setUser</span><span class=p>(</span><span class=n>user</span><span class=p>:</span> <span class=n>User</span><span class=p>,</span> <span class=n>continuation</span><span class=p>:</span> <span class=n>Continuation</span><span class=p>&lt;*&gt;):</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>checkAvailability</span><span class=p>(</span><span class=n>flight</span><span class=p>:</span> <span class=n>Flight</span><span class=p>,</span> <span class=n>continuation</span><span class=p>:</span> <span class=n>Continuation</span><span class=p>&lt;*&gt;):</span> <span class=n>Any</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=아주-간단한-중단-함수-알아보기>아주 간단한 중단 함수 알아보기<a hidden class=anchor aria-hidden=true href=#아주-간단한-중단-함수-알아보기>#</a></h2><ul><li>함수가 시작되는 지점은 함수의 시작점과 중단 이후 재개 시점(컨티뉴에이션이 resume을 호출할 때) 두 곳이다.<ul><li>현재 상태를 저장에는 <strong>label 이라는 field</strong> 를 사용한다. (처음에는 0으로 설정)</li><li>이후에는 중단되기 전에 다음 상태로 설정되어 재개 될 시점을 알 수 있게 해준다.</li></ul></li><li>delay에 의해 중단된 경우 <code>COROUTINE_SUSPENDED</code> 를 반환</li><li>myFunction 을 호출한 함수부터 시작해 콜 스택에 있는 모든 함수도 똑 같다.<ul><li>따라서, 중단이 일어나면 콜 스택에 있는 모든 함수가 종료된다</li><li>중단된 코루틴을 실행하던 스레드를 (다른 종류의 코루틴을 포함해) 실행 가능한 코드가 사용할 수 있게 된다.</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>suspend</span> <span class=k>fun</span> <span class=nf>myFunction</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>println</span><span class=p>(</span><span class=s2>&#34;Before&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=py>counter</span> <span class=p>=</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=n>delay</span><span class=p>(</span><span class=m>1000</span><span class=p>)</span> <span class=c1>// suspending
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>counter</span><span class=o>++</span>
</span></span><span class=line><span class=cl>    <span class=n>println</span><span class=p>(</span><span class=s2>&#34;Counter: </span><span class=si>$counter</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>println</span><span class=p>(</span><span class=s2>&#34;After&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=c1>// 중단 함수를의 바이트 코드를 자바로 디컴파일한 코드를 코틀린으로 표현한 코드
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fun</span> <span class=nf>myFunction</span><span class=p>(</span><span class=n>continuation</span><span class=p>:</span> <span class=n>Continuation</span><span class=p>&lt;</span><span class=n>Unit</span><span class=p>&gt;):</span> <span class=n>Any</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>continuation</span> <span class=p>=</span> <span class=n>continuation</span> <span class=k>as</span><span class=p>?</span> <span class=n>MyFunctionContinuation</span> <span class=o>?:</span> <span class=n>MyFunctionContinuation</span><span class=p>(</span><span class=n>continuation</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=py>counter</span> <span class=p>=</span> <span class=n>continuation</span><span class=p>.</span><span class=n>counter</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>continuation</span><span class=p>.</span><span class=n>label</span> <span class=o>==</span> <span class=m>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>println</span><span class=p>(</span><span class=s2>&#34;Before&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>counter</span> <span class=p>=</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>        <span class=n>continuation</span><span class=p>.</span><span class=n>counter</span> <span class=p>=</span> <span class=n>counter</span>
</span></span><span class=line><span class=cl>        <span class=n>continuation</span><span class=p>.</span><span class=n>label</span> <span class=p>=</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>delay</span><span class=p>(</span><span class=m>1000</span><span class=p>,</span> <span class=n>continuation</span><span class=p>)</span> <span class=o>==</span> <span class=n>COROUTINE_SUSPENDED</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>COROUTINE_SUSPENDED</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>continuation</span><span class=p>.</span><span class=n>label</span> <span class=o>==</span> <span class=m>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>counter</span> <span class=p>=</span> <span class=p>(</span><span class=n>counter</span> <span class=k>as</span> <span class=n>Int</span><span class=p>)</span> <span class=p>+</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>        <span class=n>println</span><span class=p>(</span><span class=s2>&#34;Counter: </span><span class=si>$counter</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>println</span><span class=p>(</span><span class=s2>&#34;After&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Unit</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>error</span><span class=p>(</span><span class=s2>&#34;Impossible&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MyFunctionContinuation</span><span class=p>(</span> <span class=c1>// 컨트뉴에이션 객체
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>val</span> <span class=py>completion</span><span class=p>:</span> <span class=n>Continuation</span><span class=p>&lt;</span><span class=n>Unit</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=p>:</span> <span class=n>Continuation</span><span class=p>&lt;</span><span class=n>Unit</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>override</span> <span class=k>val</span> <span class=py>context</span><span class=p>:</span> <span class=n>CoroutineContext</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span><span class=p>()</span> <span class=p>=</span> <span class=n>completion</span><span class=p>.</span><span class=n>context</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=py>result</span><span class=p>:</span> <span class=n>Result</span><span class=p>&lt;</span><span class=n>Unit</span><span class=p>&gt;?</span> <span class=p>=</span> <span class=k>null</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=py>label</span> <span class=p>=</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=py>counter</span> <span class=p>=</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>override</span> <span class=k>fun</span> <span class=nf>resumeWith</span><span class=p>(</span><span class=n>result</span><span class=p>:</span> <span class=n>Result</span><span class=p>&lt;</span><span class=n>Unit</span><span class=p>&gt;)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>result</span> <span class=p>=</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>        <span class=k>val</span> <span class=py>res</span> <span class=p>=</span> <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>val</span> <span class=py>r</span> <span class=p>=</span> <span class=n>myFunction</span><span class=p>(</span><span class=k>this</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>r</span> <span class=o>==</span> <span class=n>COROUTINE_SUSPENDED</span><span class=p>)</span> <span class=k>return</span>
</span></span><span class=line><span class=cl>            <span class=nc>Result</span><span class=p>.</span><span class=n>success</span><span class=p>(</span><span class=n>r</span> <span class=k>as</span> <span class=n>Unit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>e</span><span class=p>:</span> <span class=n>Throwable</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nc>Result</span><span class=p>.</span><span class=n>failure</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>completion</span><span class=p>.</span><span class=n>resumeWith</span><span class=p>(</span><span class=n>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=상태를-가진-함수>상태를 가진 함수<a hidden class=anchor aria-hidden=true href=#상태를-가진-함수>#</a></h2><ul><li>함수가 중단된 후에 다시 사용할 지역 변수나 파라미터와 같은 상태를 가지고 있다면, 함수의 컨티뉴에이션 객체에 상태를 저장해야 한다.<ul><li>함수 내에서 사용되던 값들은 중단되기 직전에 저장되고, 이후 함수가 재개될 때 복구된다.</li></ul></li></ul><h2 id=값을-받아-재개되는-함수>값을 받아 재개되는 함수<a hidden class=anchor aria-hidden=true href=#값을-받아-재개되는-함수>#</a></h2><ul><li>중단 함수로 부터 값을 받아야 하는 경우 좀 더 복잡해짐</li><li>token은 상태 0과 1에서 사용</li><li>userId는 상태 1과 2에서 사욛</li><li>Result 타입인 result는 함수가 어떻게 재개되었는지 나타냄<ul><li>함수가 값으로 재개 되면 결과는 <code>Result.Success(result)</code></li><li>함수가 예외로 재개 되면 결과는 <code>Result.Failure(exception)</code></li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>suspend</span> <span class=k>fun</span> <span class=nf>printUser</span><span class=p>(</span><span class=n>token</span><span class=p>:</span> <span class=n>String</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>println</span><span class=p>(</span><span class=s2>&#34;Before&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>userId</span> <span class=p>=</span> <span class=n>getUserId</span><span class=p>(</span><span class=n>token</span><span class=p>)</span> <span class=c1>// 중단 함수
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>println</span><span class=p>(</span><span class=s2>&#34;Got userId: </span><span class=si>$userId</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>userName</span> <span class=p>=</span> <span class=n>getUserName</span><span class=p>(</span><span class=n>userId</span><span class=p>,</span> <span class=n>token</span><span class=p>)</span> <span class=c1>// 중단 함수
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>println</span><span class=p>(</span><span class=n>User</span><span class=p>(</span><span class=n>userId</span><span class=p>,</span> <span class=n>userName</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>println</span><span class=p>(</span><span class=s2>&#34;After&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>printUser</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>token</span><span class=p>:</span> <span class=n>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>continuation</span><span class=p>:</span> <span class=n>Continuation</span><span class=p>&lt;*&gt;</span>
</span></span><span class=line><span class=cl><span class=p>):</span> <span class=n>Any</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>continuation</span> <span class=p>=</span> <span class=n>continuation</span> <span class=k>as</span><span class=p>?</span> <span class=n>PrintUserContinuation</span>
</span></span><span class=line><span class=cl>        <span class=o>?:</span> <span class=n>PrintUserContinuation</span><span class=p>(</span> <span class=n>continuation</span> <span class=k>as</span> <span class=n>Continuation</span><span class=p>&lt;</span><span class=n>Unit</span><span class=p>&gt;,</span> <span class=n>token</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=py>result</span><span class=p>:</span> <span class=n>Result</span><span class=p>&lt;</span><span class=n>Any</span><span class=p>&gt;?</span> <span class=p>=</span> <span class=n>continuation</span><span class=p>.</span><span class=n>result</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=py>userId</span><span class=p>:</span> <span class=n>String</span><span class=p>?</span> <span class=p>=</span> <span class=n>continuation</span><span class=p>.</span><span class=n>userId</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>userName</span><span class=p>:</span> <span class=n>String</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>continuation</span><span class=p>.</span><span class=n>label</span> <span class=o>==</span> <span class=m>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>println</span><span class=p>(</span><span class=s2>&#34;Before&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>continuation</span><span class=p>.</span><span class=n>label</span> <span class=p>=</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>        <span class=k>val</span> <span class=py>res</span> <span class=p>=</span> <span class=n>getUserId</span><span class=p>(</span><span class=n>token</span><span class=p>,</span> <span class=n>continuation</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>res</span> <span class=o>==</span> <span class=n>COROUTINE_SUSPENDED</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>COROUTINE_SUSPENDED</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=p>=</span> <span class=nc>Result</span><span class=p>.</span><span class=n>success</span><span class=p>(</span><span class=n>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>continuation</span><span class=p>.</span><span class=n>label</span> <span class=o>==</span> <span class=m>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>userId</span> <span class=p>=</span> <span class=n>result</span><span class=o>!!</span><span class=p>.</span><span class=n>getOrThrow</span><span class=p>()</span> <span class=k>as</span> <span class=n>String</span>
</span></span><span class=line><span class=cl>        <span class=n>println</span><span class=p>(</span><span class=s2>&#34;Got userId: </span><span class=si>$userId</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>continuation</span><span class=p>.</span><span class=n>label</span> <span class=p>=</span> <span class=m>2</span>							<span class=c1>// 다음 label을 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>continuation</span><span class=p>.</span><span class=n>userId</span> <span class=p>=</span> <span class=n>userId</span>					<span class=c1>// 컨티뉴에이션 객체에 상태를 저장
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>val</span> <span class=py>res</span> <span class=p>=</span> <span class=n>getUserName</span><span class=p>(</span><span class=n>userId</span><span class=p>,</span> <span class=n>continuation</span><span class=p>)</span>     <span class=c1>// 중단 함수를 호출
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=n>res</span> <span class=o>==</span> <span class=n>COROUTINE_SUSPENDED</span><span class=p>)</span> <span class=p>{</span>				<span class=c1>// 중단 상태일 때
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>return</span> <span class=n>COROUTINE_SUSPENDED</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=p>=</span> <span class=nc>Result</span><span class=p>.</span><span class=n>success</span><span class=p>(</span><span class=n>res</span><span class=p>)</span>					<span class=c1>// 중단되지 않았으면 결괏값을 설정
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>continuation</span><span class=p>.</span><span class=n>label</span> <span class=o>==</span> <span class=m>2</span><span class=p>)</span> <span class=p>{</span>					   
</span></span><span class=line><span class=cl>        <span class=n>result</span><span class=o>!!</span><span class=p>.</span><span class=n>throwOnFailure</span><span class=p>()</span>					    <span class=c1>// 실패할 경우 에외를 던짐
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>userName</span> <span class=p>=</span> <span class=n>result</span><span class=p>.</span><span class=n>getOrNull</span> <span class=k>as</span> <span class=n>String</span>	        <span class=c1>// 결괏값을 읽음
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>println</span><span class=p>(</span><span class=n>User</span><span class=p>(</span><span class=n>userId</span> <span class=k>as</span> <span class=n>String</span><span class=p>,</span> <span class=n>userName</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>println</span><span class=p>(</span><span class=s2>&#34;After&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Unit</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>error</span><span class=p>(</span><span class=s2>&#34;Impossible&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PrintUserContinuation</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>completion</span><span class=p>:</span> <span class=n>Continuation</span><span class=p>&lt;</span><span class=n>Unit</span><span class=p>&gt;,</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>token</span><span class=p>:</span> <span class=n>String</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=p>:</span> <span class=n>Continuation</span><span class=p>&lt;</span><span class=n>String</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>override</span> <span class=k>val</span> <span class=py>context</span><span class=p>:</span> <span class=n>CoroutineContext</span>
</span></span><span class=line><span class=cl>        <span class=k>get</span><span class=p>()</span> <span class=p>=</span> <span class=n>completion</span><span class=p>.</span><span class=n>context</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=py>label</span> <span class=p>=</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=py>result</span><span class=p>:</span> <span class=n>Result</span><span class=p>&lt;</span><span class=n>Any</span><span class=p>&gt;?</span> <span class=p>=</span> <span class=k>null</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=py>userId</span><span class=p>:</span> <span class=n>String</span><span class=p>?</span> <span class=p>=</span> <span class=k>null</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>override</span> <span class=k>fun</span> <span class=nf>resumeWith</span><span class=p>(</span><span class=n>result</span><span class=p>:</span> <span class=n>Result</span><span class=p>&lt;</span><span class=n>String</span><span class=p>&gt;)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>result</span> <span class=p>=</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>        <span class=k>val</span> <span class=py>res</span> <span class=p>=</span> <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>val</span> <span class=py>r</span> <span class=p>=</span> <span class=n>printUser</span><span class=p>(</span><span class=n>token</span><span class=p>,</span> <span class=k>this</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>r</span> <span class=o>==</span> <span class=n>COROUTINE_SUSPENDED</span><span class=p>)</span> <span class=k>return</span>
</span></span><span class=line><span class=cl>            <span class=nc>Result</span><span class=p>.</span><span class=n>success</span><span class=p>(</span><span class=n>r</span> <span class=k>as</span> <span class=n>Unit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>e</span><span class=p>:</span> <span class=n>Throwable</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nc>Result</span><span class=p>.</span><span class=n>failure</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>completion</span><span class=p>.</span><span class=n>resumeWith</span><span class=p>(</span><span class=n>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=콜-스택>콜 스택<a hidden class=anchor aria-hidden=true href=#콜-스택>#</a></h2><ul><li><p>함수 a가 함수 b를 호출하면 가상 머신은 a의 상태와 b가 끝나면 실행이 될 지점을 <strong>콜 스택(call stack)이라는 자료 구조</strong> 에 저장한다.</p></li><li><p>코루틴을 중단하면 스레드를 반환해 콜 스택에 있는 정보가 사라질 것이다.</p><ul><li>따라서 코루틴을 재개 할 때, 콜 스택을 사용할 수 없다.</li><li>대신 <code>Continuation</code> 객체가 <strong>콜 스택의 역할을 대신</strong>한다.</li></ul></li><li><p><code>Continuation</code> 객체는 중단 되었을때 상태(label)와 함수의 지역 변수와 파라미터(필드), 중단 함수를 호출한 함수가 재개될 위치 정보를 가지고 있다.</p><ul><li>하나의 <code>Continuation</code> 객체는 다른 하나를 참조하는 식으로 동작한다.</li><li><code>Continuation</code> 객체가 재개 될 때, 각 <code>Continuation</code> 객체는 자신이 담당하는 함수를 호출하고,</li><li>그 함수의 실행이 끝나면, 자신을 호출한 함수의 <code>Continuation</code> 객체을 재개 합니다.<ul><li><code>complete.resumeWith(res)</code></li></ul></li><li>이 과정은 스택의 끝에 다다를 때까지 반복된다.</li></ul></li><li><p>중단된 함수가 재개했을 때 <code>Continuation</code> 객체로 부터 상태를 복원하고, 얻은 결과를 사용하거나 예외를 던진다.</p></li><li><p>컨티뉴에이션 객체에 상태가 저장된며, 중단을 처리하기 위한 과정이 있어야 한다.</p></li><li><p>중단된 함수가 재개했을 때 컨티뉴에이션 객체로부터 상태를 복원하고, 얻은 결과를 사용하거나 예외를 던져야 한다.</p></li><li><p>예외를 던질 때도 비슷하다, 처리되지 못한 예외가 <code>resumeWith</code> 에서 잡히면 <code>Result.failure(e)</code>로 래핑되며, 예외를 던진 함수를 호출한 함수는 포장된 결과를 받는다.</p></li><li><p>함수 c에서 중단된 상황을 예로 들면</p><ul><li><p>실행이 재개되면 c의 컨티뉴에이션 객체는 c 함수를 먼저 재개</p></li><li><p>함수가 완료되면 c 컨티뉴에이션 객체는 b 함수를 호출하는 b 컨티뉴에이션 객체를 재개</p></li><li><p>b 함수가 완료되면 b 컨티뉴에이션은 a 컨티뉴에이션을 재개하고 a 함수가 호출된다.</p></li></ul></li></ul><p><img loading=lazy src=/images/before/image-20240716201908358.png alt=image-20240716201908358.png width=680 height=auto></p><p><img loading=lazy src=/images/before/image-20240716201918214.png alt=image-20240716201918214.png width=680 height=auto></p><p><img loading=lazy src=/images/before/image-20240716201934555.png alt=image-20240716201934555.png width=680 height=auto></p><h2 id=중단-함수의-성능>중단 함수의 성능<a hidden class=anchor aria-hidden=true href=#중단-함수의-성능>#</a></h2><ul><li>함수를 상태로 나누는 것은 숫자를 비교하는 것만큼 쉬운 일이며 실행점이 변하는 비용 또한 거의 들지 않음</li><li>컨티뉴에이션 객체에 상태를 저장하는 것 또한 간단하다<ul><li>지역 변수를 복사하지 않고 새로운 변수가 메모리 내 특정 값을 가리키게 한다.</li></ul></li></ul><h1 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h1><ul><li><a href=https://kotlinlang.org/docs/coroutines-guide.html>https://kotlinlang.org/docs/coroutines-guide.html</a></li><li>코틀린 코루틴 Kotlin Coroutines: Deep Dive (Marcin Moskała, 인사이트)</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://2taezeat.github.io/tags/kotlin/>Kotlin</a></li><li><a href=https://2taezeat.github.io/tags/coroutine/>Coroutine</a></li></ul><nav class=paginav><a class=prev href=https://2taezeat.github.io/posts/%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%BD%94%EB%A3%A8%ED%8B%B4/%EC%BD%94%ED%8B%80%EB%A6%B0-%EC%BD%94%EB%A3%A8%ED%8B%B4-ch05.-%EC%BD%94%EB%A3%A8%ED%8B%B4---%EC%96%B8%EC%96%B4-%EC%B0%A8%EC%9B%90%EC%97%90%EC%84%9C%EC%9D%98-%EC%A7%80%EC%9B%90-vs-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC/><span class=title>« Prev</span><br><span>[코루틴 코루틴] ch05. 코루틴 - 언어 차원에서의 지원 vs 라이브러리</span>
</a><a class=next href=https://2taezeat.github.io/posts/%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%BD%94%EB%A3%A8%ED%8B%B4/%EC%BD%94%ED%8B%80%EB%A6%B0-%EC%BD%94%EB%A3%A8%ED%8B%B4-ch03.-%EC%A4%91%EB%8B%A8%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%9E%91%EB%8F%99%ED%95%A0%EA%B9%8C/><span class=title>Next »</span><br><span>[코루틴 코루틴] ch03. 중단은 어떻게 작동할까?</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share [코루틴 코루틴] ch04. 코루틴의 실제 구현 on x" href="https://x.com/intent/tweet/?text=%5b%ec%bd%94%eb%a3%a8%ed%8b%b4%20%ec%bd%94%eb%a3%a8%ed%8b%b4%5d%20ch04.%20%ec%bd%94%eb%a3%a8%ed%8b%b4%ec%9d%98%20%ec%8b%a4%ec%a0%9c%20%ea%b5%ac%ed%98%84&amp;url=https%3a%2f%2f2taezeat.github.io%2fposts%2f%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%2f%25EC%25BD%2594%25ED%258B%2580%25EB%25A6%25B0-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-ch04.-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%25EC%259D%2598-%25EC%258B%25A4%25EC%25A0%259C-%25EA%25B5%25AC%25ED%2598%2584%2f&amp;hashtags=Kotlin%2cCoroutine"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [코루틴 코루틴] ch04. 코루틴의 실제 구현 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2f2taezeat.github.io%2fposts%2f%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%2f%25EC%25BD%2594%25ED%258B%2580%25EB%25A6%25B0-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-ch04.-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%25EC%259D%2598-%25EC%258B%25A4%25EC%25A0%259C-%25EA%25B5%25AC%25ED%2598%2584%2f&amp;title=%5b%ec%bd%94%eb%a3%a8%ed%8b%b4%20%ec%bd%94%eb%a3%a8%ed%8b%b4%5d%20ch04.%20%ec%bd%94%eb%a3%a8%ed%8b%b4%ec%9d%98%20%ec%8b%a4%ec%a0%9c%20%ea%b5%ac%ed%98%84&amp;summary=%5b%ec%bd%94%eb%a3%a8%ed%8b%b4%20%ec%bd%94%eb%a3%a8%ed%8b%b4%5d%20ch04.%20%ec%bd%94%eb%a3%a8%ed%8b%b4%ec%9d%98%20%ec%8b%a4%ec%a0%9c%20%ea%b5%ac%ed%98%84&amp;source=https%3a%2f%2f2taezeat.github.io%2fposts%2f%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%2f%25EC%25BD%2594%25ED%258B%2580%25EB%25A6%25B0-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-ch04.-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%25EC%259D%2598-%25EC%258B%25A4%25EC%25A0%259C-%25EA%25B5%25AC%25ED%2598%2584%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [코루틴 코루틴] ch04. 코루틴의 실제 구현 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2f2taezeat.github.io%2fposts%2f%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%2f%25EC%25BD%2594%25ED%258B%2580%25EB%25A6%25B0-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-ch04.-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%25EC%259D%2598-%25EC%258B%25A4%25EC%25A0%259C-%25EA%25B5%25AC%25ED%2598%2584%2f&title=%5b%ec%bd%94%eb%a3%a8%ed%8b%b4%20%ec%bd%94%eb%a3%a8%ed%8b%b4%5d%20ch04.%20%ec%bd%94%eb%a3%a8%ed%8b%b4%ec%9d%98%20%ec%8b%a4%ec%a0%9c%20%ea%b5%ac%ed%98%84"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [코루틴 코루틴] ch04. 코루틴의 실제 구현 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2f2taezeat.github.io%2fposts%2f%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%2f%25EC%25BD%2594%25ED%258B%2580%25EB%25A6%25B0-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-ch04.-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%25EC%259D%2598-%25EC%258B%25A4%25EC%25A0%259C-%25EA%25B5%25AC%25ED%2598%2584%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [코루틴 코루틴] ch04. 코루틴의 실제 구현 on whatsapp" href="https://api.whatsapp.com/send?text=%5b%ec%bd%94%eb%a3%a8%ed%8b%b4%20%ec%bd%94%eb%a3%a8%ed%8b%b4%5d%20ch04.%20%ec%bd%94%eb%a3%a8%ed%8b%b4%ec%9d%98%20%ec%8b%a4%ec%a0%9c%20%ea%b5%ac%ed%98%84%20-%20https%3a%2f%2f2taezeat.github.io%2fposts%2f%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%2f%25EC%25BD%2594%25ED%258B%2580%25EB%25A6%25B0-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-ch04.-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%25EC%259D%2598-%25EC%258B%25A4%25EC%25A0%259C-%25EA%25B5%25AC%25ED%2598%2584%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [코루틴 코루틴] ch04. 코루틴의 실제 구현 on telegram" href="https://telegram.me/share/url?text=%5b%ec%bd%94%eb%a3%a8%ed%8b%b4%20%ec%bd%94%eb%a3%a8%ed%8b%b4%5d%20ch04.%20%ec%bd%94%eb%a3%a8%ed%8b%b4%ec%9d%98%20%ec%8b%a4%ec%a0%9c%20%ea%b5%ac%ed%98%84&amp;url=https%3a%2f%2f2taezeat.github.io%2fposts%2f%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%2f%25EC%25BD%2594%25ED%258B%2580%25EB%25A6%25B0-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-ch04.-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%25EC%259D%2598-%25EC%258B%25A4%25EC%25A0%259C-%25EA%25B5%25AC%25ED%2598%2584%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [코루틴 코루틴] ch04. 코루틴의 실제 구현 on ycombinator" href="https://news.ycombinator.com/submitlink?t=%5b%ec%bd%94%eb%a3%a8%ed%8b%b4%20%ec%bd%94%eb%a3%a8%ed%8b%b4%5d%20ch04.%20%ec%bd%94%eb%a3%a8%ed%8b%b4%ec%9d%98%20%ec%8b%a4%ec%a0%9c%20%ea%b5%ac%ed%98%84&u=https%3a%2f%2f2taezeat.github.io%2fposts%2f%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%2f%25EC%25BD%2594%25ED%258B%2580%25EB%25A6%25B0-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-ch04.-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%25EC%259D%2598-%25EC%258B%25A4%25EC%25A0%259C-%25EA%25B5%25AC%25ED%2598%2584%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><script src=https://utteranc.es/client.js repo=2taezeat/blog_comment issue-term=pathname label=comment theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2024 <a href=https://2taezeat.github.io/>2taezeat, blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>