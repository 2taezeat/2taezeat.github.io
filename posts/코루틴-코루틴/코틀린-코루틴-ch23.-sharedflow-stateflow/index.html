<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[코틀린 코루틴] ch23. SharedFlow, StateFlow | 2taezeat, blog</title>
<meta name=keywords content="Kotlin,Coroutine"><meta name=description content="ch23. SharedFlow, StateFlow"><meta name=author content="2taezeat"><link rel=canonical href=http://localhost:1313/posts/%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%BD%94%EB%A3%A8%ED%8B%B4/%EC%BD%94%ED%8B%80%EB%A6%B0-%EC%BD%94%EB%A3%A8%ED%8B%B4-ch23.-sharedflow-stateflow/><meta name=google-site-verification content="YaEERzgrvu-ZwPg7gswZdTzRMufkHw3uIH7i8hVal1c"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.6e2e604ea5f627f6fb97a6a218445753397c457285e9bb47bd4cea346337d49e.css integrity="sha256-bi5gTqX2J/b7l6aiGERXUzl8RXKF6btHvUzqNGM31J4=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/icon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/icon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/icon/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/icon/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%BD%94%EB%A3%A8%ED%8B%B4/%EC%BD%94%ED%8B%80%EB%A6%B0-%EC%BD%94%EB%A3%A8%ED%8B%B4-ch23.-sharedflow-stateflow/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="[코틀린 코루틴] ch23. SharedFlow, StateFlow"><meta property="og:description" content="ch23. SharedFlow, StateFlow"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%BD%94%EB%A3%A8%ED%8B%B4/%EC%BD%94%ED%8B%80%EB%A6%B0-%EC%BD%94%EB%A3%A8%ED%8B%B4-ch23.-sharedflow-stateflow/"><meta property="og:image" content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-23T11:30:03+00:00"><meta property="article:modified_time" content="2024-02-23T11:30:03+00:00"><meta property="og:site_name" content="2taezeat, blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="[코틀린 코루틴] ch23. SharedFlow, StateFlow"><meta name=twitter:description content="ch23. SharedFlow, StateFlow"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"[코틀린 코루틴] ch23. SharedFlow, StateFlow","item":"http://localhost:1313/posts/%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%BD%94%EB%A3%A8%ED%8B%B4/%EC%BD%94%ED%8B%80%EB%A6%B0-%EC%BD%94%EB%A3%A8%ED%8B%B4-ch23.-sharedflow-stateflow/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[코틀린 코루틴] ch23. SharedFlow, StateFlow","name":"[코틀린 코루틴] ch23. SharedFlow, StateFlow","description":"ch23. SharedFlow, StateFlow","keywords":["Kotlin","Coroutine"],"articleBody":"SharedFlow SharedFlow를 통해 메시지를 보내면, 대기하고 있는 모든 코루틴이 수신하게 된다. 브로드캐스트 Channel과 비슷하다. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 suspend fun main(): Unit = coroutineScope { val mutableSharedFlow = MutableSharedFlow\u003cString\u003e(replay = 0) // or MutableSharedFlow() launch { mutableSharedFlow.collect { println(\"#1 received $it\") } } launch { mutableSharedFlow.collect { println(\"#2 received $it\") } } delay(1000) mutableSharedFlow.emit(\"Message1\") mutableSharedFlow.emit(\"Message2\") } // (1 sec) // #1 received Message1 // #2 received Message1 // #1 received Message2 // #2 received Message2 // (program never ends) 위 프로그램은 coroutineScope의 자식 코루틴이 launch로 시작된 뒤 MutableSharedFlow를 감지하고 있는 상태 임으로 종료되지 않는다. 프로그램을 종료하려면 전체 스코프를 취소해야 한다.\nMutabledSharedFlow는 메시지 보내는 작업을 유지 할 수도 있다. 기본값이 0인 replay 인자를 설정하면 마지막으로 전송한 값들이 정해진 수 만큼 저장된다. 코루틴이 감지를 시작하면 저장된 값들을 먼저 받게 된다. resetReplayCache를 사용하면 값을 저장한 캐시를 초기화 할 수 있다. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 suspend fun main(): Unit = coroutineScope { val mutableSharedFlow = MutableSharedFlow\u003cString\u003e( replay = 2, ) mutableSharedFlow.emit(\"Message1\") mutableSharedFlow.emit(\"Message2\") mutableSharedFlow.emit(\"Message3\") println(mutableSharedFlow.replayCache) // [Message2, Message3] launch { mutableSharedFlow.collect { println(\"#1 received $it\") } // #1 received Message2 // #1 received Message3 } delay(100) mutableSharedFlow.resetReplayCache() println(mutableSharedFlow.replayCache) // [] } 코틀린에서는 감지만 하는 인터페이스와 변경하는 인터페이스를 구분하는 것이 관행이다.\n예시, SendChannel, ReceiveChannel, Channel로 구분 하는 것 같은 법칙으로 MutableSharedFlow는 SharedFlow와 FlowCollector 모두를 상속한다. SharedFlow: Flow를 상속하고, 감지하는 목적 (collect) FlowCollector: 값을 내보내는 목적 (emit) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 suspend fun main(): Unit = coroutineScope { val mutableSharedFlow = MutableSharedFlow\u003cString\u003e() val sharedFlow: SharedFlow\u003cString\u003e = mutableSharedFlow val collector: FlowCollector\u003cString\u003e = mutableSharedFlow launch { mutableSharedFlow.collect { println(\"#1 received $it\") } } launch { sharedFlow.collect { println(\"#2 received $it\") } } delay(1000) mutableSharedFlow.emit(\"Message1\") collector.emit(\"Message2\") } // (1 sec) // #1 received Message1 // #2 received Message1 // #1 received Message2 // #2 received Message2 안드로이드에서 SharedFlow를 사용하는 예시\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 class UserProfileViewModel { private val _userChanges = MutableSharedFlow\u003cUserChange\u003e() val userChanges: SharedFlow\u003cUserChange\u003e = _userChanges fun onCreate() { viewModelScope.launch { userChanges.collect(::applyUserChange) } } fun onNameChanged(newName: String) { // ... _userChanges.emit(NameChange(newName)) } fun onPublicKeyChanged(newPublicKey: String) { // ... _userChanges.emit(PublicKeyChange(newPublicKey)) } } shareIn 플로우는 변화를 감지할 때 주로 사용 된다. 다양한 클래스가 변화를 감지하는 상황에서 하나의 플로우로 여러 개의 플로우를 만들고 싶다면, SharedFlow가 해결책이다. Flow를 SharedFlow로 바꾸는 쉬운 방법은 shareIn 함수를 사용하는 것이다. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 suspend fun main(): Unit = coroutineScope { val flow = flowOf(\"A\", \"B\", \"C\") .onEach { delay(1000) } val sharedFlow: SharedFlow\u003cString\u003e = flow.shareIn( scope = this, started = SharingStarted.Eagerly, // replay = 0 (default) ) delay(500) launch { sharedFlow.collect { println(\"#1 $it\") } } delay(1000) launch { sharedFlow.collect { println(\"#2 $it\") } } delay(1000) launch { sharedFlow.collect { println(\"#3 $it\") } } } // (1 sec) // #1 A // (1 sec) // #1 B // #2 B // (1 sec) // #1 C // #2 C // #3 C shareIn 함수는 SharedFlow를 만들고 Flow의 원소를 보낸다. 플로우의 원소를 모으는 코루틴을 시작하므로 shareIn 함수는 첫 번째 인자로 코루틴 스코프를 받는다. 세 번째 인자는 기본값이 0인 replay 값이다. 두 번째 인자인 started는 리스너의 수에 따라 값을 언제부터 감지할지 결정한다. SharingStarted.Eagerly: 즉시 값을 감지하기 시작하고 플로우로 값을 전송한다. SharingStarted.Lazily: 첫 번째 구독자가 나올 때 감지하기 시작한다. 모든 구독자가 사라져도 업스트림(데이터를 방출하는) 플로우는 Active 상태이지지만, 구독자가 없으면 replay 수 만큼 가장 최근의 값들을 캐싱한다. WhileSubscribed(): 첫 번째 구독자가 나올때 감지하기 시작하며, 마지막 구독자가 사라지면 플로우도 멈춘다. SharingStarted 인터페이스를 구현하여 커스텀도 가능하다. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 suspend fun main(): Unit = coroutineScope { val flow = flowOf(\"A\", \"B\", \"C\") val sharedFlow: SharedFlow\u003cString\u003e = flow.shareIn( scope = this, started = SharingStarted.Eagerly, ) delay(100) launch { sharedFlow.collect { println(\"#1 $it\") } } print(\"Done\") } // (0.1 sec) // Done 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 suspend fun main(): Unit = coroutineScope { val flow1 = flowOf(\"A\", \"B\", \"C\") val flow2 = flowOf(\"D\") .onEach { delay(1000) } val sharedFlow = merge(flow1, flow2).shareIn( scope = this, started = SharingStarted.Lazily, ) delay(100) launch { sharedFlow.collect { println(\"#1 $it\") } } delay(1000) launch { sharedFlow.collect { println(\"#2 $it\") } } } // (0.1 sec) // #1 A // #1 B // #1 C // (1 sec) // #2 D // #1 D 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 suspend fun main(): Unit = coroutineScope { val flow = flowOf(\"A\", \"B\", \"C\", \"D\") .onStart { println(\"Started\") } .onCompletion { println(\"Finished\") } .onEach { delay(1000) } val sharedFlow = flow.shareIn( scope = this, started = SharingStarted.WhileSubscribed(), ) delay(3000) launch { println(\"#1 ${sharedFlow.first()}\") } launch { println(\"#2 ${sharedFlow.take(2).toList()}\") } delay(3000) launch { println(\"#3 ${sharedFlow.first()}\") } } // (3 sec) // Started // (1 sec) // #1 A // (1 sec) // #2 [A, B] // Finished // (1 sec) // Started // (1 sec) // #3 A // Finished 동일한 변화를 감지하려고 하는 서비스가 여러 개일 때, shareIn 을 사용하면 된다. 다양한 서비스가 location 에 의존하고 있다면, 각 서비스가 데이터베이스를 독자적으로 감지하는 건 최적화된 방법이 아니다. 대신 이런 변화를 SharedFlow를 통해 감지된 변화를 공유하는 것이 좋다. replay = 1: 구독자가 location 의 마지막 목록을 즉시 받기 원할 때 replay = 0: 구독 후의 변경에만 반응할 때 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 @Dao interface LocationDao { @Insert(onConflict = OnConflictStrategy.IGNORE) suspend fun insertLocation(location: Location) @Query(\"DELETE FROM location_table\") suspend fun deleteLocations() @Query(\"SELECT * FROM location_table ORDER BY time\") fun observeLocations(): Flow\u003cList\u003cLocation\u003e\u003e } class LocationService( locationDao: LocationDao, scope: CoroutineScope ) { private val locations = locationDao.observeLocations() .shareIn( scope = scope, started = SharingStarted.WhileSubscribed(), ) fun observeLocations(): Flow\u003cList\u003cLocation\u003e\u003e = locations } 호출 할 때마다 새로운 SharedFlow를 만들면 안되고, SharedFlow를 만든 뒤 프로퍼티로 저장하자.\nStateFlow StateFlow 는 SharedFlow의 개념을 확장 시킨 것으로, replay 값이 1인 SharedFlow와 비슷하게 작동한다. StateFlow 는 value 프로퍼티로 접근 가능한 값 하나를 항상 가지고 있다. 초기 값은 생성자를 통해 전달되어야 한다. value 프로퍼티로 값을 얻어 올 수도 있고, 설정 할 수도 있다. MutableStateFlow는 값을 감지할 수 있는 보관소 이다. 1 2 3 4 5 6 7 8 9 10 11 interface StateFlow\u003cout T\u003e : SharedFlow\u003cT\u003e { val value: T } interface MutableStateFlow\u003cT\u003e : StateFlow\u003cT\u003e, MutableSharedFlow\u003cT\u003e { override var value: T fun compareAndSet(expect: T, update: T): Boolean } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 suspend fun main() = coroutineScope { val state = MutableStateFlow(\"A\") println(state.value) // A launch { state.collect { println(\"Value changed to $it\") } // Value changed to A } delay(1000) state.value = \"B\" // Value changed to B delay(1000) launch { state.collect { println(\"and now it is $it\") } // and now it is B } delay(1000) state.value = \"C\" // Value changed to C and now it is C } 안드로이드에서 StateFlow는 LiveData를 대체하는 최신 방식으로 사용되고 있다. 코루틴을 완벽하게 지원한다. 초기 값을 가지고 있기 때문에 null일 필요가 없다. StateFlow 는 주로 ViewModel의 상태를 나타낼 때 주로 사용된다. StateFlow 는 상태를 감지할 수 있으며, 감지된 상태에 따라 View가 보여주고 갱신된다. 1 2 3 4 5 6 7 8 9 10 11 12 class LatestNewsViewModel( private val newsRepository: NewsRepository ) : ViewModel() { private val _uiState = MutableStateFlow\u003cNewsState\u003e(LoadingNews) val uiState: StateFlow\u003cNewsState\u003e = _uiState fun onCreate() { scope.launch { _uiState.value = NewsLoaded(newsRepository.getNews()) } } } StateFlow 는 데이터가 덮어 씌워지기 때문에, observe가 느린 경우, 상태의 중간 변화를 받을 수 없는 경우도 있다. 모든 이벤트를 다 받으려면, StateFlow가 아니라, SharedFlow를 사용해야 한다. StateFlow는 현재 상태만 나타내기 때문에, StateFlow의 이전 상태는 아무도 관심이 없다. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 suspend fun main(): Unit = coroutineScope { val state = MutableStateFlow('X') launch { for (c in 'A'..'E') { delay(300) state.value = c // or state.emit(c) } } state.collect { delay(1000) println(it) } } // X // C // E stateIn stateIn 는 Flow를 StateFlow 로 변환하는 함수이다. 스코프에서만 호출 가능하지만, 중단 함수 이기도 하다. StateFlow는 항상 값을 가져야 하기에, 값을 명시하지 않았을 때는 첫 번째 값이 계산될 때까지 기다려야 한다. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 suspend fun main() = coroutineScope { val flow = flowOf(\"A\", \"B\", \"C\") .onEach { delay(1000) } .onEach { println(\"Produced $it\") } val stateFlow: StateFlow\u003cString\u003e = flow.stateIn(this) println(\"Listening\") println(stateFlow.value) stateFlow.collect { println(\"Received $it\") } } // (1 sec) // Produced A // Listening // A // Received A // (1 sec) // Produced B // Received B // (1 sec) // Produced C // Received C stateIn의 두 번째 형태는 중단 함수가 아니지만, 초기 값과 started 모드를 지정해야 한다. started 모드는 shareIn과 같은 옵션을 가진다. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 suspend fun main() = coroutineScope { val flow = flowOf(\"A\", \"B\") .onEach { delay(1000) } .onEach { println(\"Produced $it\") } val stateFlow: StateFlow\u003cString\u003e = flow.stateIn( scope = this, started = SharingStarted.Lazily, initialValue = \"Empty\" ) println(stateFlow.value) delay(2000) stateFlow.collect { println(\"Received $it\") } } // Empty // (2 sec) // Received Empty // (1 sec) // Produced A // Received A // (1 sec) // Produced B // Received B 하나의 데이터 소스에서 값이 변경된 걸 감지하는 경우에 주로 stateIn 함수를 사용한다. StateFlow로 상태를 변경할 수 있으며, 결국엔 View가 변화를 감지 할 수 있게 된다. 1 2 3 4 5 6 7 8 9 10 11 class LocationsViewModel(locationService: LocationService) : ViewModel() { private val location = locationService.observeLocations() .map { it.toLocationsDisplay() } .stateIn( scope = viewModelScope, started = SharingStarted.Lazily, initialValue = LocationsDisplay.Loading, ) // ... } Reference https://kotlinlang.org/docs/coroutines-guide.html 코틀린 코루틴 Kotlin Coroutines: Deep Dive (Marcin Moskała, 인사이트) ","wordCount":"1713","inLanguage":"en","image":"http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-02-23T11:30:03Z","dateModified":"2024-02-23T11:30:03Z","author":{"@type":"Person","name":"2taezeat"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%BD%94%EB%A3%A8%ED%8B%B4/%EC%BD%94%ED%8B%80%EB%A6%B0-%EC%BD%94%EB%A3%A8%ED%8B%B4-ch23.-sharedflow-stateflow/"},"publisher":{"@type":"Organization","name":"2taezeat, blog","logo":{"@type":"ImageObject","url":"http://localhost:1313/icon/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="2taezeat blog (Alt + H)"><img src=http://localhost:1313/icon/apple-touch-icon.png alt aria-label=logo height=30>2taezeat blog</a><div class=logo-switches></div></div><ul id=menu><li><a href=http://localhost:1313/tags/ title=Tags><span>Tags</span></a></li><li><a href=http://localhost:1313/archives/ title=Archives><span>Archives</span></a></li><li><a href=http://localhost:1313/searchs/ title=Search><span>Search</span></a></li><li><a href=https://github.com/2taezeat title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">[코틀린 코루틴] ch23. SharedFlow, StateFlow</h1><div class=post-description>ch23. SharedFlow, StateFlow</div><div class=post-meta><span title='2024-02-23 11:30:03 +0000 +0000'>2024-02-23</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;1713 words&nbsp;·&nbsp;2taezeat</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#sharedflow>SharedFlow</a><ul><li><a href=#sharein>shareIn</a></li></ul></li><li><a href=#stateflow>StateFlow</a><ul><li><a href=#statein>stateIn</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></div></details></div><div class=post-content><h1 id=sharedflow>SharedFlow<a hidden class=anchor aria-hidden=true href=#sharedflow>#</a></h1><ul><li><code>SharedFlow</code>를 통해 메시지를 보내면, <strong>대기하고 있는 모든 코루틴</strong>이 <strong>수신</strong>하게 된다.<ul><li><strong>브로드캐스트 Channel</strong>과 비슷하다.</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>suspend</span> <span class=k>fun</span> <span class=nf>main</span><span class=p>():</span> <span class=n>Unit</span> <span class=p>=</span> <span class=n>coroutineScope</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>mutableSharedFlow</span> <span class=p>=</span>
</span></span><span class=line><span class=cl>        <span class=n>MutableSharedFlow</span><span class=p>&lt;</span><span class=n>String</span><span class=p>&gt;(</span><span class=n>replay</span> <span class=p>=</span> <span class=m>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// or MutableSharedFlow&lt;String&gt;()
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=n>launch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>mutableSharedFlow</span><span class=p>.</span><span class=n>collect</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;#1 received </span><span class=si>$it</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>launch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>mutableSharedFlow</span><span class=p>.</span><span class=n>collect</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;#2 received </span><span class=si>$it</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>delay</span><span class=p>(</span><span class=m>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>mutableSharedFlow</span><span class=p>.</span><span class=n>emit</span><span class=p>(</span><span class=s2>&#34;Message1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>mutableSharedFlow</span><span class=p>.</span><span class=n>emit</span><span class=p>(</span><span class=s2>&#34;Message2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// (1 sec)
</span></span></span><span class=line><span class=cl><span class=c1>// #1 received Message1
</span></span></span><span class=line><span class=cl><span class=c1>// #2 received Message1
</span></span></span><span class=line><span class=cl><span class=c1>// #1 received Message2
</span></span></span><span class=line><span class=cl><span class=c1>// #2 received Message2
</span></span></span><span class=line><span class=cl><span class=c1>// (program never ends)
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>위 프로그램은 <code>coroutineScope</code>의 <strong>자식 코루틴이 launch</strong>로 시작된 뒤 <code>MutableSharedFlow</code>를 <strong>감지</strong>하고 있는 상태 임으로 종료되지 않는다.
프로그램을 종료하려면 <strong>전체 스코프를 취소</strong>해야 한다.</p></blockquote><ul><li><code>MutabledSharedFlow</code>는 메시지 보내는 작업을 <strong>유지</strong> 할 수도 있다.</li><li><strong>기본값이 0</strong>인 <code>replay</code> 인자를 설정하면 <strong>마지막으로 전송한 값</strong>들이 정해진 수 만큼 <strong>저장</strong>된다.</li><li>코루틴이 <strong>감지</strong>를 시작하면 <strong>저장된 값들을 먼저 받게</strong> 된다.</li><li><code>resetReplayCache</code>를 사용하면 값을 저장한 캐시를 <strong>초기화</strong> 할 수 있다.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>suspend</span> <span class=k>fun</span> <span class=nf>main</span><span class=p>():</span> <span class=n>Unit</span> <span class=p>=</span> <span class=n>coroutineScope</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>mutableSharedFlow</span> <span class=p>=</span> <span class=n>MutableSharedFlow</span><span class=p>&lt;</span><span class=n>String</span><span class=p>&gt;(</span>
</span></span><span class=line><span class=cl>        <span class=n>replay</span> <span class=p>=</span> <span class=m>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>mutableSharedFlow</span><span class=p>.</span><span class=n>emit</span><span class=p>(</span><span class=s2>&#34;Message1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>mutableSharedFlow</span><span class=p>.</span><span class=n>emit</span><span class=p>(</span><span class=s2>&#34;Message2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>mutableSharedFlow</span><span class=p>.</span><span class=n>emit</span><span class=p>(</span><span class=s2>&#34;Message3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>println</span><span class=p>(</span><span class=n>mutableSharedFlow</span><span class=p>.</span><span class=n>replayCache</span><span class=p>)</span>   <span class=c1>// [Message2, Message3]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=n>launch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>mutableSharedFlow</span><span class=p>.</span><span class=n>collect</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;#1 received </span><span class=si>$it</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>// #1 received Message2
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// #1 received Message3
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>delay</span><span class=p>(</span><span class=m>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>mutableSharedFlow</span><span class=p>.</span><span class=n>resetReplayCache</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>println</span><span class=p>(</span><span class=n>mutableSharedFlow</span><span class=p>.</span><span class=n>replayCache</span><span class=p>)</span> <span class=c1>// []
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>코틀린에서는 <strong>감지만 하는 인터페이스</strong>와 <strong>변경하는 인터페이스</strong>를 구분하는 것이 관행이다.</p><ul><li>예시, <code>SendChannel, ReceiveChannel, Channel</code>로 구분 하는 것</li><li>같은 법칙으로 <code>MutableSharedFlow</code>는 <code>SharedFlow</code>와 <code>FlowCollector</code> 모두를 <strong>상속</strong>한다.<ul><li><code>SharedFlow</code>: Flow를 상속하고, <strong>감지</strong>하는 목적 (<code>collect</code>)</li><li><code>FlowCollector</code>: 값을 <strong>내보내는</strong> 목적 (<code>emit</code>)</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>suspend</span> <span class=k>fun</span> <span class=nf>main</span><span class=p>():</span> <span class=n>Unit</span> <span class=p>=</span> <span class=n>coroutineScope</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>mutableSharedFlow</span> <span class=p>=</span> <span class=n>MutableSharedFlow</span><span class=p>&lt;</span><span class=n>String</span><span class=p>&gt;()</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>sharedFlow</span><span class=p>:</span> <span class=n>SharedFlow</span><span class=p>&lt;</span><span class=n>String</span><span class=p>&gt;</span> <span class=p>=</span> <span class=n>mutableSharedFlow</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>collector</span><span class=p>:</span> <span class=n>FlowCollector</span><span class=p>&lt;</span><span class=n>String</span><span class=p>&gt;</span> <span class=p>=</span> <span class=n>mutableSharedFlow</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>launch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>mutableSharedFlow</span><span class=p>.</span><span class=n>collect</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;#1 received </span><span class=si>$it</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>launch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>sharedFlow</span><span class=p>.</span><span class=n>collect</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;#2 received </span><span class=si>$it</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>delay</span><span class=p>(</span><span class=m>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>mutableSharedFlow</span><span class=p>.</span><span class=n>emit</span><span class=p>(</span><span class=s2>&#34;Message1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>collector</span><span class=p>.</span><span class=n>emit</span><span class=p>(</span><span class=s2>&#34;Message2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// (1 sec)
</span></span></span><span class=line><span class=cl><span class=c1>// #1 received Message1
</span></span></span><span class=line><span class=cl><span class=c1>// #2 received Message1
</span></span></span><span class=line><span class=cl><span class=c1>// #1 received Message2
</span></span></span><span class=line><span class=cl><span class=c1>// #2 received Message2
</span></span></span></code></pre></td></tr></table></div></div><p>안드로이드에서 <code>SharedFlow</code>를 사용하는 예시</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserProfileViewModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>_userChanges</span> <span class=p>=</span> <span class=n>MutableSharedFlow</span><span class=p>&lt;</span><span class=n>UserChange</span><span class=p>&gt;()</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>userChanges</span><span class=p>:</span> <span class=n>SharedFlow</span><span class=p>&lt;</span><span class=n>UserChange</span><span class=p>&gt;</span> <span class=p>=</span> <span class=n>_userChanges</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>fun</span> <span class=nf>onCreate</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>viewModelScope</span><span class=p>.</span><span class=n>launch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>userChanges</span><span class=p>.</span><span class=n>collect</span><span class=p>(</span><span class=o>::</span><span class=n>applyUserChange</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>fun</span> <span class=nf>onNameChanged</span><span class=p>(</span><span class=n>newName</span><span class=p>:</span> <span class=n>String</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>_userChanges</span><span class=p>.</span><span class=n>emit</span><span class=p>(</span><span class=n>NameChange</span><span class=p>(</span><span class=n>newName</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>fun</span> <span class=nf>onPublicKeyChanged</span><span class=p>(</span><span class=n>newPublicKey</span><span class=p>:</span> <span class=n>String</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>_userChanges</span><span class=p>.</span><span class=n>emit</span><span class=p>(</span><span class=n>PublicKeyChange</span><span class=p>(</span><span class=n>newPublicKey</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=sharein>shareIn<a hidden class=anchor aria-hidden=true href=#sharein>#</a></h2><ul><li>플로우는 <strong>변화를 감지</strong>할 때 주로 사용 된다.</li><li><strong>다양한 클래스</strong>가 <strong>변화를 감지</strong>하는 상황에서 <strong>하나의 플로우</strong>로 <strong>여러 개의 플로우</strong>를 만들고 싶다면, <code>SharedFlow</code>가 해결책이다.</li><li><code>Flow</code>를 <code>SharedFlow</code>로 바꾸는 쉬운 방법은 <code>shareIn</code> 함수를 사용하는 것이다.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>suspend</span> <span class=k>fun</span> <span class=nf>main</span><span class=p>():</span> <span class=n>Unit</span> <span class=p>=</span> <span class=n>coroutineScope</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>flow</span> <span class=p>=</span> <span class=n>flowOf</span><span class=p>(</span><span class=s2>&#34;A&#34;</span><span class=p>,</span> <span class=s2>&#34;B&#34;</span><span class=p>,</span> <span class=s2>&#34;C&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>onEach</span> <span class=p>{</span> <span class=n>delay</span><span class=p>(</span><span class=m>1000</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>sharedFlow</span><span class=p>:</span> <span class=n>SharedFlow</span><span class=p>&lt;</span><span class=n>String</span><span class=p>&gt;</span> <span class=p>=</span> <span class=n>flow</span><span class=p>.</span><span class=n>shareIn</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>scope</span> <span class=p>=</span> <span class=k>this</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>started</span> <span class=p>=</span> <span class=nc>SharingStarted</span><span class=p>.</span><span class=n>Eagerly</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=c1>// replay = 0 (default)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>delay</span><span class=p>(</span><span class=m>500</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>launch</span> <span class=p>{</span> <span class=n>sharedFlow</span><span class=p>.</span><span class=n>collect</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;#1 </span><span class=si>$it</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>delay</span><span class=p>(</span><span class=m>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>launch</span> <span class=p>{</span> <span class=n>sharedFlow</span><span class=p>.</span><span class=n>collect</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;#2 </span><span class=si>$it</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>delay</span><span class=p>(</span><span class=m>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>launch</span> <span class=p>{</span> <span class=n>sharedFlow</span><span class=p>.</span><span class=n>collect</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;#3 </span><span class=si>$it</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// (1 sec)
</span></span></span><span class=line><span class=cl><span class=c1>// #1 A
</span></span></span><span class=line><span class=cl><span class=c1>// (1 sec)
</span></span></span><span class=line><span class=cl><span class=c1>// #1 B
</span></span></span><span class=line><span class=cl><span class=c1>// #2 B
</span></span></span><span class=line><span class=cl><span class=c1>// (1 sec)
</span></span></span><span class=line><span class=cl><span class=c1>// #1 C
</span></span></span><span class=line><span class=cl><span class=c1>// #2 C
</span></span></span><span class=line><span class=cl><span class=c1>// #3 C
</span></span></span></code></pre></td></tr></table></div></div><ul><li><code>shareIn</code> 함수는 <code>SharedFlow</code>를 만들고 <code>Flow</code>의 원소를 보낸다.</li><li>플로우의 원소를 모으는 코루틴을 시작하므로 <code>shareIn</code> 함수는 <strong>첫 번째 인자</strong>로 <strong>코루틴 스코프</strong>를 받는다.</li><li><strong>세 번째 인자</strong>는 <strong>기본값이 0</strong>인 <code>replay</code> 값이다.</li><li><strong>두 번째 인자</strong>인 <code>started</code>는 리스너의 수에 따라 <strong>값을 언제부터 감지</strong>할지 결정한다.<ul><li><code>SharingStarted.Eagerly</code>: <strong>즉시 값을 감지</strong>하기 시작하고 플로우로 값을 전송한다.</li><li><code>SharingStarted.Lazily</code>: <strong>첫 번째 구독자가 나올 때</strong> 감지하기 시작한다. 모든 구독자가 사라져도 업스트림(데이터를 방출하는) 플로우는 <strong>Active 상태</strong>이지지만, 구독자가
없으면 <code>replay</code> 수 만큼 가장 최근의 값들을 <strong>캐싱</strong>한다.</li><li><code>WhileSubscribed()</code>: <strong>첫 번째 구독자가 나올때</strong> 감지하기 시작하며, <strong>마지막 구독자가 사라지면 플로우도 멈춘다.</strong></li><li><code>SharingStarted</code> 인터페이스를 구현하여 <strong>커스텀</strong>도 가능하다.</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>suspend</span> <span class=k>fun</span> <span class=nf>main</span><span class=p>():</span> <span class=n>Unit</span> <span class=p>=</span> <span class=n>coroutineScope</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>flow</span> <span class=p>=</span> <span class=n>flowOf</span><span class=p>(</span><span class=s2>&#34;A&#34;</span><span class=p>,</span> <span class=s2>&#34;B&#34;</span><span class=p>,</span> <span class=s2>&#34;C&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>sharedFlow</span><span class=p>:</span> <span class=n>SharedFlow</span><span class=p>&lt;</span><span class=n>String</span><span class=p>&gt;</span> <span class=p>=</span> <span class=n>flow</span><span class=p>.</span><span class=n>shareIn</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>scope</span> <span class=p>=</span> <span class=k>this</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>started</span> <span class=p>=</span> <span class=nc>SharingStarted</span><span class=p>.</span><span class=n>Eagerly</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>delay</span><span class=p>(</span><span class=m>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>launch</span> <span class=p>{</span> <span class=n>sharedFlow</span><span class=p>.</span><span class=n>collect</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;#1 </span><span class=si>$it</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=s2>&#34;Done&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// (0.1 sec)
</span></span></span><span class=line><span class=cl><span class=c1>// Done
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>suspend</span> <span class=k>fun</span> <span class=nf>main</span><span class=p>():</span> <span class=n>Unit</span> <span class=p>=</span> <span class=n>coroutineScope</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>flow1</span> <span class=p>=</span> <span class=n>flowOf</span><span class=p>(</span><span class=s2>&#34;A&#34;</span><span class=p>,</span> <span class=s2>&#34;B&#34;</span><span class=p>,</span> <span class=s2>&#34;C&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>flow2</span> <span class=p>=</span> <span class=n>flowOf</span><span class=p>(</span><span class=s2>&#34;D&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>onEach</span> <span class=p>{</span> <span class=n>delay</span><span class=p>(</span><span class=m>1000</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>sharedFlow</span> <span class=p>=</span> <span class=n>merge</span><span class=p>(</span><span class=n>flow1</span><span class=p>,</span> <span class=n>flow2</span><span class=p>).</span><span class=n>shareIn</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>scope</span> <span class=p>=</span> <span class=k>this</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>started</span> <span class=p>=</span> <span class=nc>SharingStarted</span><span class=p>.</span><span class=n>Lazily</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>delay</span><span class=p>(</span><span class=m>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>launch</span> <span class=p>{</span> <span class=n>sharedFlow</span><span class=p>.</span><span class=n>collect</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;#1 </span><span class=si>$it</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>delay</span><span class=p>(</span><span class=m>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>launch</span> <span class=p>{</span> <span class=n>sharedFlow</span><span class=p>.</span><span class=n>collect</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;#2 </span><span class=si>$it</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// (0.1 sec)
</span></span></span><span class=line><span class=cl><span class=c1>// #1 A
</span></span></span><span class=line><span class=cl><span class=c1>// #1 B
</span></span></span><span class=line><span class=cl><span class=c1>// #1 C
</span></span></span><span class=line><span class=cl><span class=c1>// (1 sec)
</span></span></span><span class=line><span class=cl><span class=c1>// #2 D
</span></span></span><span class=line><span class=cl><span class=c1>// #1 D
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>suspend</span> <span class=k>fun</span> <span class=nf>main</span><span class=p>():</span> <span class=n>Unit</span> <span class=p>=</span> <span class=n>coroutineScope</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>flow</span> <span class=p>=</span> <span class=n>flowOf</span><span class=p>(</span><span class=s2>&#34;A&#34;</span><span class=p>,</span> <span class=s2>&#34;B&#34;</span><span class=p>,</span> <span class=s2>&#34;C&#34;</span><span class=p>,</span> <span class=s2>&#34;D&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>onStart</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;Started&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>onCompletion</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;Finished&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>onEach</span> <span class=p>{</span> <span class=n>delay</span><span class=p>(</span><span class=m>1000</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>sharedFlow</span> <span class=p>=</span> <span class=n>flow</span><span class=p>.</span><span class=n>shareIn</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>scope</span> <span class=p>=</span> <span class=k>this</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>started</span> <span class=p>=</span> <span class=nc>SharingStarted</span><span class=p>.</span><span class=n>WhileSubscribed</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>delay</span><span class=p>(</span><span class=m>3000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>launch</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;#1 </span><span class=si>${sharedFlow.first()}</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>launch</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;#2 </span><span class=si>${sharedFlow.take(2).toList()}</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>delay</span><span class=p>(</span><span class=m>3000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>launch</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;#3 </span><span class=si>${sharedFlow.first()}</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// (3 sec)
</span></span></span><span class=line><span class=cl><span class=c1>// Started
</span></span></span><span class=line><span class=cl><span class=c1>// (1 sec)
</span></span></span><span class=line><span class=cl><span class=c1>// #1 A
</span></span></span><span class=line><span class=cl><span class=c1>// (1 sec)
</span></span></span><span class=line><span class=cl><span class=c1>// #2 [A, B]
</span></span></span><span class=line><span class=cl><span class=c1>// Finished
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// (1 sec)
</span></span></span><span class=line><span class=cl><span class=c1>// Started
</span></span></span><span class=line><span class=cl><span class=c1>// (1 sec)
</span></span></span><span class=line><span class=cl><span class=c1>// #3 A
</span></span></span><span class=line><span class=cl><span class=c1>// Finished
</span></span></span></code></pre></td></tr></table></div></div><ul><li><strong>동일한 변화</strong>를 <strong>감지</strong>하려고 하는 서비스가 <strong>여러 개</strong>일 때, <code>shareIn</code> 을 사용하면 된다.</li><li>다양한 서비스가 <strong><em>location</em></strong> 에 의존하고 있다면, 각 서비스가 데이터베이스를 <strong>독자적으로 감지하는 건</strong> 최적화된 방법이 아니다.</li><li>대신 이런 변화를 <code>SharedFlow</code>를 통해 <strong>감지된 변화를 공유</strong>하는 것이 좋다.<ul><li><code>replay = 1</code>: 구독자가 <strong><em>location</em></strong> 의 <strong>마지막 목록을 즉시 받기</strong> 원할 때</li><li><code>replay = 0</code>: <strong>구독 후의 변경</strong>에만 반응할 때</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=nd>@Dao</span>
</span></span><span class=line><span class=cl><span class=k>interface</span> <span class=nc>LocationDao</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Insert</span><span class=p>(</span><span class=n>onConflict</span> <span class=p>=</span> <span class=nc>OnConflictStrategy</span><span class=p>.</span><span class=n>IGNORE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>suspend</span> <span class=k>fun</span> <span class=nf>insertLocation</span><span class=p>(</span><span class=n>location</span><span class=p>:</span> <span class=n>Location</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Query</span><span class=p>(</span><span class=s2>&#34;DELETE FROM location_table&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>suspend</span> <span class=k>fun</span> <span class=nf>deleteLocations</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Query</span><span class=p>(</span><span class=s2>&#34;SELECT * FROM location_table ORDER BY time&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>fun</span> <span class=nf>observeLocations</span><span class=p>():</span> <span class=n>Flow</span><span class=p>&lt;</span><span class=n>List</span><span class=p>&lt;</span><span class=n>Location</span><span class=p>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>LocationService</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>locationDao</span><span class=p>:</span> <span class=n>LocationDao</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>scope</span><span class=p>:</span> <span class=n>CoroutineScope</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>locations</span> <span class=p>=</span> <span class=n>locationDao</span><span class=p>.</span><span class=n>observeLocations</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>shareIn</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>scope</span> <span class=p>=</span> <span class=n>scope</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>started</span> <span class=p>=</span> <span class=nc>SharingStarted</span><span class=p>.</span><span class=n>WhileSubscribed</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>fun</span> <span class=nf>observeLocations</span><span class=p>():</span> <span class=n>Flow</span><span class=p>&lt;</span><span class=n>List</span><span class=p>&lt;</span><span class=n>Location</span><span class=p>&gt;&gt;</span> <span class=p>=</span> <span class=n>locations</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p><strong>호출 할 때마다</strong> 새로운 <code>SharedFlow</code>를 만들면 안되고, <code>SharedFlow</code>를 만든 뒤 <strong>프로퍼티</strong>로 저장하자.</p></blockquote><h1 id=stateflow>StateFlow<a hidden class=anchor aria-hidden=true href=#stateflow>#</a></h1><ul><li><code>StateFlow</code> 는 <code>SharedFlow</code>의 개념을 확장 시킨 것으로, <strong>replay 값이 1</strong>인 <code>SharedFlow</code>와 비슷하게 작동한다.</li><li><code>StateFlow</code> 는 <code>value</code> <strong>프로퍼티</strong>로 <strong>접근 가능한 값 하나를 항상</strong> 가지고 있다.<ul><li><strong>초기 값</strong>은 <strong>생성자</strong>를 통해 전달되어야 한다.</li><li><code>value</code> <strong>프로퍼티</strong>로 <strong>값을 얻어</strong> 올 수도 있고, <strong>설정</strong> 할 수도 있다.</li><li><code>MutableStateFlow</code>는 <strong>값을 감지할 수 있는 보관소</strong> 이다.</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>interface</span> <span class=nc>StateFlow</span><span class=p>&lt;</span><span class=k>out</span> <span class=n>T</span><span class=p>&gt;</span> <span class=p>:</span> <span class=n>SharedFlow</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>value</span><span class=p>:</span> <span class=n>T</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>interface</span> <span class=nc>MutableStateFlow</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>StateFlow</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;,</span> <span class=n>MutableSharedFlow</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>override</span> <span class=k>var</span> <span class=py>value</span><span class=p>:</span> <span class=n>T</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>fun</span> <span class=nf>compareAndSet</span><span class=p>(</span><span class=k>expect</span><span class=p>:</span> <span class=n>T</span><span class=p>,</span> <span class=n>update</span><span class=p>:</span> <span class=n>T</span><span class=p>):</span> <span class=n>Boolean</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>suspend</span> <span class=k>fun</span> <span class=nf>main</span><span class=p>()</span> <span class=p>=</span> <span class=n>coroutineScope</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>state</span> <span class=p>=</span> <span class=n>MutableStateFlow</span><span class=p>(</span><span class=s2>&#34;A&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>println</span><span class=p>(</span><span class=n>state</span><span class=p>.</span><span class=k>value</span><span class=p>)</span> <span class=c1>// A
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>launch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>.</span><span class=n>collect</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;Value changed to </span><span class=si>$it</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Value changed to A
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>delay</span><span class=p>(</span><span class=m>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span><span class=p>.</span><span class=k>value</span> <span class=p>=</span> <span class=s2>&#34;B&#34;</span> <span class=c1>// Value changed to B
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=n>delay</span><span class=p>(</span><span class=m>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>launch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>.</span><span class=n>collect</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;and now it is </span><span class=si>$it</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>// and now it is B
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>delay</span><span class=p>(</span><span class=m>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span><span class=p>.</span><span class=k>value</span> <span class=p>=</span> <span class=s2>&#34;C&#34;</span> <span class=c1>// Value changed to C and now it is C
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>안드로이드에서 <code>StateFlow</code>는 <code>LiveData</code>를 대체하는 최신 방식으로 사용되고 있다.<ul><li><strong>코루틴</strong>을 완벽하게 지원한다.</li><li><strong>초기 값</strong>을 가지고 있기 때문에 <code>null</code>일 필요가 없다.</li><li><code>StateFlow</code> 는 주로 <code>ViewModel</code>의 <strong>상태</strong>를 나타낼 때 주로 사용된다.</li><li><code>StateFlow</code> 는 <strong>상태</strong>를 감지할 수 있으며, 감지된 상태에 따라 <strong>View</strong>가 보여주고 갱신된다.</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>class</span> <span class=nc>LatestNewsViewModel</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>newsRepository</span><span class=p>:</span> <span class=n>NewsRepository</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=p>:</span> <span class=n>ViewModel</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>_uiState</span> <span class=p>=</span> <span class=n>MutableStateFlow</span><span class=p>&lt;</span><span class=n>NewsState</span><span class=p>&gt;(</span><span class=n>LoadingNews</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>uiState</span><span class=p>:</span> <span class=n>StateFlow</span><span class=p>&lt;</span><span class=n>NewsState</span><span class=p>&gt;</span> <span class=p>=</span> <span class=n>_uiState</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>fun</span> <span class=nf>onCreate</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>scope</span><span class=p>.</span><span class=n>launch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>_uiState</span><span class=p>.</span><span class=k>value</span> <span class=p>=</span> <span class=n>NewsLoaded</span><span class=p>(</span><span class=n>newsRepository</span><span class=p>.</span><span class=n>getNews</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>StateFlow</code> 는 <strong>데이터가 덮어 씌워지기</strong> 때문에, <strong>observe가 느린 경우</strong>, 상태의 <strong>중간 변화</strong>를 받을 수 없는 경우도 있다.<ul><li><strong>모든 이벤트</strong>를 다 받으려면, <code>StateFlow</code>가 아니라, <code>SharedFlow</code>를 사용해야 한다.</li><li><code>StateFlow</code>는 <strong>현재 상태</strong>만 나타내기 때문에, <code>StateFlow</code>의 <strong>이전 상태</strong>는 아무도 관심이 없다.</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>suspend</span> <span class=k>fun</span> <span class=nf>main</span><span class=p>():</span> <span class=n>Unit</span> <span class=p>=</span> <span class=n>coroutineScope</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>state</span> <span class=p>=</span> <span class=n>MutableStateFlow</span><span class=p>(</span><span class=sc>&#39;X&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>launch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>c</span> <span class=k>in</span> <span class=sc>&#39;A&#39;</span><span class=o>..</span><span class=sc>&#39;E&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>delay</span><span class=p>(</span><span class=m>300</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>.</span><span class=k>value</span> <span class=p>=</span> <span class=n>c</span>
</span></span><span class=line><span class=cl>            <span class=c1>// or state.emit(c)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>state</span><span class=p>.</span><span class=n>collect</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>delay</span><span class=p>(</span><span class=m>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>println</span><span class=p>(</span><span class=k>it</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// X
</span></span></span><span class=line><span class=cl><span class=c1>// C
</span></span></span><span class=line><span class=cl><span class=c1>// E
</span></span></span></code></pre></td></tr></table></div></div><h2 id=statein>stateIn<a hidden class=anchor aria-hidden=true href=#statein>#</a></h2><ul><li><code>stateIn</code> 는 <code>Flow&lt;T></code>를 <code>StateFlow&lt;T></code> 로 변환하는 함수이다.</li><li><strong>스코프</strong>에서만 호출 가능하지만, <strong>중단 함수</strong> 이기도 하다.</li><li><code>StateFlow</code>는 항상 <strong>값을 가져야</strong> 하기에, <strong>값을 명시하지 않았을 때</strong>는 <strong>첫 번째 값</strong>이 <strong>계산될 때까지 기다려야 한다.</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>suspend</span> <span class=k>fun</span> <span class=nf>main</span><span class=p>()</span> <span class=p>=</span> <span class=n>coroutineScope</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>flow</span> <span class=p>=</span> <span class=n>flowOf</span><span class=p>(</span><span class=s2>&#34;A&#34;</span><span class=p>,</span> <span class=s2>&#34;B&#34;</span><span class=p>,</span> <span class=s2>&#34;C&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>onEach</span> <span class=p>{</span> <span class=n>delay</span><span class=p>(</span><span class=m>1000</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>onEach</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;Produced </span><span class=si>$it</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>stateFlow</span><span class=p>:</span> <span class=n>StateFlow</span><span class=p>&lt;</span><span class=n>String</span><span class=p>&gt;</span> <span class=p>=</span> <span class=n>flow</span><span class=p>.</span><span class=n>stateIn</span><span class=p>(</span><span class=k>this</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>println</span><span class=p>(</span><span class=s2>&#34;Listening&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>println</span><span class=p>(</span><span class=n>stateFlow</span><span class=p>.</span><span class=k>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>stateFlow</span><span class=p>.</span><span class=n>collect</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;Received </span><span class=si>$it</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// (1 sec)
</span></span></span><span class=line><span class=cl><span class=c1>// Produced A
</span></span></span><span class=line><span class=cl><span class=c1>// Listening
</span></span></span><span class=line><span class=cl><span class=c1>// A
</span></span></span><span class=line><span class=cl><span class=c1>// Received A
</span></span></span><span class=line><span class=cl><span class=c1>// (1 sec)
</span></span></span><span class=line><span class=cl><span class=c1>// Produced B
</span></span></span><span class=line><span class=cl><span class=c1>// Received B
</span></span></span><span class=line><span class=cl><span class=c1>// (1 sec)
</span></span></span><span class=line><span class=cl><span class=c1>// Produced C
</span></span></span><span class=line><span class=cl><span class=c1>// Received C
</span></span></span></code></pre></td></tr></table></div></div><ul><li><code>stateIn</code>의 두 번째 형태는 <strong>중단 함수</strong>가 아니지만, <strong>초기 값</strong>과 <strong>started 모드</strong>를 지정해야 한다.<ul><li><code>started</code> 모드는 <code>shareIn</code>과 <strong>같은 옵션</strong>을 가진다.</li></ul></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>suspend</span> <span class=k>fun</span> <span class=nf>main</span><span class=p>()</span> <span class=p>=</span> <span class=n>coroutineScope</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>flow</span> <span class=p>=</span> <span class=n>flowOf</span><span class=p>(</span><span class=s2>&#34;A&#34;</span><span class=p>,</span> <span class=s2>&#34;B&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>onEach</span> <span class=p>{</span> <span class=n>delay</span><span class=p>(</span><span class=m>1000</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>onEach</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;Produced </span><span class=si>$it</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>stateFlow</span><span class=p>:</span> <span class=n>StateFlow</span><span class=p>&lt;</span><span class=n>String</span><span class=p>&gt;</span> <span class=p>=</span> <span class=n>flow</span><span class=p>.</span><span class=n>stateIn</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>scope</span> <span class=p>=</span> <span class=k>this</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>started</span> <span class=p>=</span> <span class=nc>SharingStarted</span><span class=p>.</span><span class=n>Lazily</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>initialValue</span> <span class=p>=</span> <span class=s2>&#34;Empty&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>println</span><span class=p>(</span><span class=n>stateFlow</span><span class=p>.</span><span class=k>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>delay</span><span class=p>(</span><span class=m>2000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>stateFlow</span><span class=p>.</span><span class=n>collect</span> <span class=p>{</span> <span class=n>println</span><span class=p>(</span><span class=s2>&#34;Received </span><span class=si>$it</span><span class=s2>&#34;</span><span class=p>)</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// Empty
</span></span></span><span class=line><span class=cl><span class=c1>// (2 sec)
</span></span></span><span class=line><span class=cl><span class=c1>// Received Empty
</span></span></span><span class=line><span class=cl><span class=c1>// (1 sec)
</span></span></span><span class=line><span class=cl><span class=c1>// Produced A
</span></span></span><span class=line><span class=cl><span class=c1>// Received A
</span></span></span><span class=line><span class=cl><span class=c1>// (1 sec)
</span></span></span><span class=line><span class=cl><span class=c1>// Produced B
</span></span></span><span class=line><span class=cl><span class=c1>// Received B
</span></span></span></code></pre></td></tr></table></div></div><ul><li><strong>하나의 데이터 소스</strong>에서 <strong>값이 변경된 걸 감지</strong>하는 경우에 주로 <code>stateIn</code> 함수를 사용한다.</li><li><code>StateFlow</code>로 <strong>상태</strong>를 <strong>변경</strong>할 수 있으며, 결국엔 <code>View</code>가 <strong>변화를 감지</strong> 할 수 있게 된다.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>class</span> <span class=nc>LocationsViewModel</span><span class=p>(</span><span class=n>locationService</span><span class=p>:</span> <span class=n>LocationService</span><span class=p>)</span> <span class=p>:</span> <span class=n>ViewModel</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>val</span> <span class=py>location</span> <span class=p>=</span> <span class=n>locationService</span><span class=p>.</span><span class=n>observeLocations</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>map</span> <span class=p>{</span> <span class=k>it</span><span class=p>.</span><span class=n>toLocationsDisplay</span><span class=p>()</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>stateIn</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>scope</span> <span class=p>=</span> <span class=n>viewModelScope</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>started</span> <span class=p>=</span> <span class=nc>SharingStarted</span><span class=p>.</span><span class=n>Lazily</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>initialValue</span> <span class=p>=</span> <span class=nc>LocationsDisplay</span><span class=p>.</span><span class=n>Loading</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h1><ul><li><a href=https://kotlinlang.org/docs/coroutines-guide.html>https://kotlinlang.org/docs/coroutines-guide.html</a></li><li>코틀린 코루틴 Kotlin Coroutines: Deep Dive (Marcin Moskała, 인사이트)</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/kotlin/>Kotlin</a></li><li><a href=http://localhost:1313/tags/coroutine/>Coroutine</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/posts/os/%EC%BB%B4%ED%93%A8%ED%84%B0%EA%B5%AC%EC%A1%B0-+-%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-ch09.-%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0/><span class=title>« Prev</span><br><span>[컴퓨터구조 + 운영체제] ch09. 운영체제 시작하기</span>
</a><a class=next href=http://localhost:1313/posts/%EC%BD%94%EB%A3%A8%ED%8B%B4-%EC%BD%94%EB%A3%A8%ED%8B%B4/%EC%BD%94%ED%8B%80%EB%A6%B0-%EC%BD%94%EB%A3%A8%ED%8B%B4-ch22.-flow-%EC%83%9D%EB%AA%85%EC%A3%BC%EA%B8%B0-%ED%95%A8%EC%88%98/><span class=title>Next »</span><br><span>[코루틴 코루틴] ch22. Flow 생명주기 함수</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share [코틀린 코루틴] ch23. SharedFlow, StateFlow on x" href="https://x.com/intent/tweet/?text=%5b%ec%bd%94%ed%8b%80%eb%a6%b0%20%ec%bd%94%eb%a3%a8%ed%8b%b4%5d%20ch23.%20SharedFlow%2c%20StateFlow&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%2f%25EC%25BD%2594%25ED%258B%2580%25EB%25A6%25B0-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-ch23.-sharedflow-stateflow%2f&amp;hashtags=Kotlin%2cCoroutine"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [코틀린 코루틴] ch23. SharedFlow, StateFlow on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%2f%25EC%25BD%2594%25ED%258B%2580%25EB%25A6%25B0-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-ch23.-sharedflow-stateflow%2f&amp;title=%5b%ec%bd%94%ed%8b%80%eb%a6%b0%20%ec%bd%94%eb%a3%a8%ed%8b%b4%5d%20ch23.%20SharedFlow%2c%20StateFlow&amp;summary=%5b%ec%bd%94%ed%8b%80%eb%a6%b0%20%ec%bd%94%eb%a3%a8%ed%8b%b4%5d%20ch23.%20SharedFlow%2c%20StateFlow&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2f%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%2f%25EC%25BD%2594%25ED%258B%2580%25EB%25A6%25B0-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-ch23.-sharedflow-stateflow%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [코틀린 코루틴] ch23. SharedFlow, StateFlow on reddit" href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2f%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%2f%25EC%25BD%2594%25ED%258B%2580%25EB%25A6%25B0-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-ch23.-sharedflow-stateflow%2f&title=%5b%ec%bd%94%ed%8b%80%eb%a6%b0%20%ec%bd%94%eb%a3%a8%ed%8b%b4%5d%20ch23.%20SharedFlow%2c%20StateFlow"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [코틀린 코루틴] ch23. SharedFlow, StateFlow on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2f%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%2f%25EC%25BD%2594%25ED%258B%2580%25EB%25A6%25B0-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-ch23.-sharedflow-stateflow%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [코틀린 코루틴] ch23. SharedFlow, StateFlow on whatsapp" href="https://api.whatsapp.com/send?text=%5b%ec%bd%94%ed%8b%80%eb%a6%b0%20%ec%bd%94%eb%a3%a8%ed%8b%b4%5d%20ch23.%20SharedFlow%2c%20StateFlow%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2f%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%2f%25EC%25BD%2594%25ED%258B%2580%25EB%25A6%25B0-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-ch23.-sharedflow-stateflow%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [코틀린 코루틴] ch23. SharedFlow, StateFlow on telegram" href="https://telegram.me/share/url?text=%5b%ec%bd%94%ed%8b%80%eb%a6%b0%20%ec%bd%94%eb%a3%a8%ed%8b%b4%5d%20ch23.%20SharedFlow%2c%20StateFlow&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%2f%25EC%25BD%2594%25ED%258B%2580%25EB%25A6%25B0-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-ch23.-sharedflow-stateflow%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [코틀린 코루틴] ch23. SharedFlow, StateFlow on ycombinator" href="https://news.ycombinator.com/submitlink?t=%5b%ec%bd%94%ed%8b%80%eb%a6%b0%20%ec%bd%94%eb%a3%a8%ed%8b%b4%5d%20ch23.%20SharedFlow%2c%20StateFlow&u=http%3a%2f%2flocalhost%3a1313%2fposts%2f%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4%2f%25EC%25BD%2594%25ED%258B%2580%25EB%25A6%25B0-%25EC%25BD%2594%25EB%25A3%25A8%25ED%258B%25B4-ch23.-sharedflow-stateflow%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><script src=https://utteranc.es/client.js repo=2taezeat/blog_comment issue-term=pathname label=comment theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>2taezeat, blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>